<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>StringMaker | Switchboard 1.0.0 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="StringMaker | Switchboard 1.0.0 ">
      
      <link rel="icon" href="../assets/SwitchboardIconBorderless16.ico">
      <link rel="stylesheet" href="../styles/docfx.min.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      

      <script>
        MathJax = {
          options: {
            processHtmlClass: ['tex2jax_process', 'math']
          }
        };
      </script>

      <script type="text/javascript" src="../styles/docfx.min.js"></script>
      <script type="text/javascript" src="../styles/main.js"></script>
  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../assets/SwitchboardIconBorderless64.png" alt="Switchboard 1.0.0">
            Switchboard 1.0.0
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="StringMaker">
<h1 id="stringmaker">StringMaker</h1>

<p>You may be aware that string manipulation in C# can allocate a lot of memory for garbage collection. You may have used a class like StringBuilder to mitigate this concern. However, as of Unity 2021, the append methods of StringBuilder allocate garbage memory. Also, there are many numerical values that StringBuilder and ToString() simply are not capable of rendering.</p>
<p>As I was working on dependency injection it seemed logical to implement a logger service. A logger is maybe the most obvious example of a service that a dependency injector may provide, and I had a need for persistent log files. My dissatisfaction with other solutions lead me down one rabbit hole after another as I found myself wanting to improve on whatever I saw. I didn't want to accept that I would have to potentially allocate garbage memory just to have reliable log files. So, to make a long story short, Switchboard is able to concatenate any string you can imagine and write it as UTF-8 bytes in a text file without ever allocating any memory for garbage collection.</p>
<p>How do I avoid garbage collection? Well, the same way anyone does, by pooling memory. When memory is needed, it is indeed allocated, but when it is no longer needed it is cached away for later re-use. You may wonder, does that lead to bloated memory pools instead of garbage collection? Hopefully, after reading the sections on Collections and Memory Management, you will agree that I have indeed created a good solution. However, if you don't want to use memory pooling at all, every memory pool in this framework can have its max count set to 0, and garbage collection will function as normal.</p>
<p>So, back to StringBuilder. StringBuilder is supposed to help with garbage memory allocation when working with strings, right? Well, StringBuilder still allocates new memory that must be garbage collected during many of its operations. First of all, appending any kind of number variable, as of Unity 2021, is going to result in a call to the ToString() method. That method will allocate a new garbage string every time. So, if you're trying to eliminate garbage collection by using StringBuilder, I hope you don't want to append the value of any number variables. Secondly, StringBuilder allocates new character arrays internally in chunks as needed. That may not seem like an issue, and usually it's not. However, if you append a lot of characters, resulting in multiple chunks being allocated, and then set the Length to 0, guess what happens? A brand new array of characters is allocated. The length of the new array is equal to the entire capacity of all chunks that were previously allocated. All of the old chunks are then discarded for garbage collection. I bet you didn't assume that would happen from something like StringBuilder.Length = 0. StringBuilder doesn't really know how to reduce its Length beyond the boundary of the current chunk without allocating garbage memory.</p>
<p>So, I created StringMaker as an alternative. Neither StringBuilder nor StringMaker are implemented as an interface. They are both tightly coupled, strong dependencies no matter which one you use. However, I designed StringMaker to have an interface that would closely align with StringBuilder. That way you can do a find and replace operation to replace one with the other. Most of methods should function as expected. However, there are some methods I did not replicate in StringMaker because I view them as unnecessary or inherently costly, and StringMaker includes some methods that StringBuilder does not.</p>
</article>

        <div class="contribution d-print-none">
        </div>

        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span> <span>Switchboard was created by <a href="https://www.linkedin.com/in/ronnie-moon-12209380/">Ronnie Moon</a>.  Copyright © 2023 <a href="http://www.swipetrack.com/">SwipeTrack Solutions</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>